{"version":3,"file":"static/webpack/static/development/pages/login.js.ba26c1f2fdd32ed625c0.hot-update.js","sources":["webpack:///./pages/login.js"],"sourcesContent":["import { Component, createRef } from 'react';\nimport styled from 'styled-components';\nimport Flashes from '../components/Flashes';\nimport Input from '../components/forms/Input';\n\nimport Header from '../components/Header';\n\nimport { createFlash } from '../lib/flashes';\nimport { login, redirectIfAuthenticated } from '../lib/auth';\nimport { emailValidate } from '../lib/validation';\nimport { apiPost } from '../lib/api';\n\n// import { login } from '../services/userApi';\n\nconst LoginStyle = styled.section`\n    padding: 2rem 0 10rem;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-direction: column;\n    .admin {\n        margin-left: auto;\n        padding-top: 2rem;\n        padding-right: 2rem;\n        .button {\n            text-decoration: none;\n            color: #000;\n            border: 1px solid black;\n            padding: 0.6rem 0.8rem;\n            :hover {\n                background: #00a9e0;\n                color: #fff;\n            }\n        }\n    }\n    h2 { \n        padding-top: 7rem;\n        margin-bottom: 1.2rem;\n    }\n\n    button { \n        margin-top: 1.6rem; \n        text-align: center;\n        :hover {\n            background: #00a9e0;\n            color: #fff;\n        } \n    }\n\n    >p { margin-top: 1.4rem; }\n\n    .login {\n        padding-top: 2rem;\n    }\n\n    .loginBtn {\n        text-align: center;\n    }\n\n`;\n\nclass Login extends Component {\n    static async getInitialProps(ctx) {\n        if (redirectIfAuthenticated(ctx)) {\n            return {};\n        }\n\n        return {};\n    }\n\n    constructor(props) {\n        super(props);\n\n        this.flashesComponent = createRef();\n        this.state = {\n            email: '',\n            emailValid: true,\n            password: '',\n            passwordValid: true,\n        };\n    }\n\n    // State handlers\n    updateEmailState = (value) => {\n        if (value.length === 0 || value.length > 2) {\n            this.validateEmail(value);\n        }\n\n        this.setState({ email: value });\n    }\n    \n    updatePasswordState = (value) => {\n        if (value.length === 0 || value.length > 2) {\n            this.validatePassword(value);\n        }\n\n        this.setState({ password: value });\n    }\n\n    // Validation\n    validateEmail = (value) => {\n        const email = value.trim();\n        let emailValid = '';\n        if (email) {\n            emailValid = (email.length > 0 && emailValidate(email));\n            this.setState({ emailValid });\n            return emailValid;\n        }\n        this.setState({ emailValid });\n        return emailValid;\n    };\n\n    validatePassword = (value) => {\n        const password = value.trim();\n        let passwordValid = '';\n        if (password.contains('Test')) {\n            passwordValid = (password.length > 0 && passwordValidate(password));\n            this.setState({ passwordValid });\n            return passwordValid;\n        }\n        this.setState({ passwordValid });\n        return passwordValid;\n    };\n\n    validateForm = () => {\n        let isValid = true;\n\n        if (!this.validatePassword(this.state.password)) {\n            isValid = false;\n            // Add a flash error\n            const flash = createFlash('error', 'Wrong Email or Password');\n\n            this.flashesComponent.current.addFlash(flash);\n        }\n\n        return isValid;\n    };\n\n    // Event handlers\n    submitForm = async (e) => {\n        e.preventDefault();\n        if (this.validateForm()) {\n            const { email, password } = this.state;\n            const response = await apiPost({}, '/valid', {\n                email,\n                password,\n            });\n\n            if (response.status === 200) {\n                login(this.state.email);\n            } else if (response.status === 400) {\n                const flash = createFlash('error', 'Wrong Email and password');\n\n                this.flashesComponent.current.addFlash(flash);\n            }\n        }\n\n        return {};\n    };\n\n    render() {\n        return (\n            <LoginStyle>\n                <div className=\"admin\">\n                    <a href=\"/admin\" className='button'>Admin</a>\n                </div>\n                <Header title=\"Login\"/>\n                <Flashes\n                    ref={this.flashesComponent}\n                    flashes={this.props.flashes}\n                />\n                <form className=\"login\" onSubmit={this.submitForm}>\n                    <Input\n                        label=\"Email Address\"\n                        type=\"email\"\n                        name=\"email\"\n                        value={this.state.email}\n                        changeState={this.updateEmailState}\n                        isValid={this.state.emailValid}\n                        helperMessage=\"* Required\"\n                        errorMessage=\"Must be a valid Enigma address\"\n                    />\n                    <Input\n                        label=\"Password\"\n                        type=\"password\"\n                        name=\"password\"\n                        value={this.state.password}\n                        changeState={this.updatePasswordState}\n                        isValid={this.state.passwordValid}\n                        helperMessage=\"* Required\"\n                        errorMessage=\"Wrong password\"\n                    />\n                    <div className=\"loginBtn\">\n                        <button type=\"submit\">Login</button>\n                    </div>\n                </form>\n            </LoginStyle>\n        );\n    }\n}\n\nexport default Login;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAGA;AACA;AA8CA;;;;;;;;;;AACA;;;;;AACA;;;;;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;;;;;;AAEA;AAAA;AACA;AADA;AACA;AAAA;AACA;AAFA;AAcA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AApBA;AAsBA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AA5BA;AA+BA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAzCA;AA2CA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AArDA;AAuDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAqEA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAKA;AACA;AAFA;AACA;AALA;AAIA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhBA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAtEA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAJA;AAJA;AAUA;AACA;AACA;;;AA8EA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AAEA;AAAA;AAEA;AACA;AAFA;AAIA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAUA;AAAA;AACA;AAAA;AAKA;;;;AAzIA;AACA;AA2IA;;;;;;;;;;;;;;;;;;;;;;;A","sourceRoot":""}